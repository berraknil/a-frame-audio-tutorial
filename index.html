<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Kitchen</title>
  <link rel="stylesheet" type="text/css" media="screen" href="index.css" />
  <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
  <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v4.0.2/dist/aframe-extras.min.js"></script>
  <script src="https://unpkg.com/aframe-animation-component@^4.1.2/dist/aframe-animation-component.min.js"></script>
  <script src="https://unpkg.com/aframe-aabb-collider-component@^2.2.1/dist/aframe-aabb-collider-component.min.js"></script>
</head>

<body>
  <!-- <script>  AFRAME.registerComponent('hello-world', {
      init: function () {
        console.log('Hello, World!');
      }
    });</script> -->
  <!-- 
<script>
    AFRAME.registerComponent('radio-toggle', {
      init: function() {
        let playing = false;
        var el = this.el;
        let audioEl = document.querySelector('#radioModel');
    
        audioEl.addEventListener("loaded", (e) => {
          console.log("AUDIO LOADED")
          console.log(e)
          var audio = audioEl.components.sound;
          el.addEventListener('click', (ee) => {
            console.log(ee)
            if (!playing) {
              audio.playSound();
            } else {
              audio.pauseSound();
  
            }
            playing = !playing;
          });
  
        })
      }
    });
  <script>AFRAME.registerComponent('log', {
      schema: {
        event: { type: 'string', default: '' },
        message: { type: 'string', default: 'Hello, World!' }
      },
      init: function () {
        var self = this;

        this.eventHandlerFn = function () { console.log(self.data.message) }
      },
      update: function (oldData) {
        var data = this.data;
        var el = this.el;

        if (oldData.event && data.event !== oldData.event) {
          el.addEventListener(data.event, this.eventHandlerFn);
        } else {
          console.log(data.message);
        }
      }
    });</script>



  <script>AFRAME.registerComponent('box', {
      schema: {
        width: { type: 'number', default: 1 },
        height: { type: 'number', default: 1 },
        depth: { type: 'number', default: 1 },
        color: { type: 'color', default: '#AAA' }
      },

      init: function () {
        var data = this.data;
        var el = this.el;
        this.geometry = new THREE.BoxBufferGeometry(data.width, data.height, data.depth);
        this.material = new THREE.MeshStandardMaterial({ color: data.color });
        this.mesh = new THREE.Mesh(this.geometry, this.material);
        el.setObject3D('mesh', this.mesh);
      },

      /**
       * Update the mesh in response to property updates.
       */
      update: function (oldData) {
        var data = this.data;
        var el = this.el;

        // If `oldData` is empty, then this means we're in the initialization process.
        // No need to update.
        if (Object.keys(oldData).length === 0) { return; }

        // Geometry-related properties changed. Update the geometry.
        if (data.width !== oldData.width ||
          data.height !== oldData.height ||
          data.depth !== oldData.depth) {
          el.getObject3D('mesh').geometry = new THREE.BoxBufferGeometry(data.width, data.height,
            data.depth);
        }

        // Material-related properties changed. Update the material.
        if (data.color !== oldData.color) {
          el.getObject3D('mesh').material.color = data.color;
        }
      },
      remove: function () {
        this.el.removeObject3D('mesh');
      }
    });</script></script> -->

  <!-- https://aframe.io/docs/0.8.0/components/sound.html#pause-and-resume -->

  <!-- https://jsfiddle.net/fq2pqwfx/2/ -->
  <!-- https://aframe.io/docs/0.8.0/introduction/writing-a-component.html -->
  <!-- https://stackoverflow.com/questions/47921013/play-sound-on-click-in-a-frame -->
  <!-- https://stackoverflow.com/questions/48129947/a-frame-playing-pausing-sound-with-a-custom-a-sound-source -->


  <script>
    AFRAME.registerComponent('audiohandler', {
      init: function () {
        
      },
      update: function () {
        let data = this.data;
        let el = this.el;
        let playing = false
        el.addEventListener('click', () => {
          console.log(el.components.sound);
          console.log(el.components.sound.isPlaying);
          if (playing) {
            el.components.sound.pauseSound();
            playing = false
          } else{
            el.components.sound.playSound();
            playing = true
          } 
        })
      }
      // /**
      //  * Update the mesh in response to property updates.
      //  */
      // update: function (oldData) {
      //   var data = this.data;
      //   var el = this.el;

      //   // If `oldData` is empty, then this means we're in the initialization process.
      //   // No need to update.
      //   if (Object.keys(oldData).length === 0) { return; }

      //   // Geometry-related properties changed. Update the geometry.
      //   if (data.width !== oldData.width ||
      //       data.height !== oldData.height ||
      //       data.depth !== oldData.depth) {
      //     el.getObject3D('mesh').geometry = new THREE.BoxBufferGeometry(data.width, data.height,
      //                                                                   data.depth);
      //   }

      //   // Material-related properties changed. Update the material.
      //   if (data.color !== oldData.color) {
      //     el.getObject3D('mesh').material.color = data.color;
      //   }
      // }


      //         init: function() {
      //           let playing = false;
      //           let audio = document.querySelector("#radioModel");
      //           this.el.addEventListener('click', () => {
      //             if (!playing) {
      //               audio.components.sound.playSound();
      //             } else {
      //               audio.components.sound.pauseSound();
      //               // audio.currentTime = 0;
      //             }
      //             playing = !playing;
      //           });
      //         }
    });</script>




  <a-scene light="defaultLightsEnabled: false" sound="src: url(./assets/audio/roomTone.mp3); loop:true; autoplay:false; volume:0.1; positional: false">

    <a-entity log="event: anEvent; message: Hello, Frameverse!"></a-entity>

    <!-- Assets -->
    <a-assets>
      <!-- Audio Assets -->
      <audio id="espressoMachine" src="./assets/audio/espressoMachine.wav"></audio>
      <audio id="toaster" src="./assets/audio/toaster.wav"></audio>
      <audio id="bottle" src="./assets/audio/bottle.wav"></audio>
      <audio id="music" src="./assets/audio/Tom Jobim - Children's Games.mp3"></audio>


      <!-- Models -->
      <a-asset-item id="kitchen" src="/assets/kitchen/model.gltf"></a-asset-item>
      <a-asset-item id="coffeeMaker" src="/assets/coffee/nespresso_vertuo_plus.gltf"></a-asset-item>
      <a-asset-item id="emptyMug" src="/assets/mug/Mug.gltf"></a-asset-item>
      <a-asset-item id="plate" src="/assets/plate/Dish.gltf"></a-asset-item>
      <a-asset-item id="toast" src="/assets/toast/model.gltf"></a-asset-item>
      <a-asset-item id="pan" src="/assets/pan/model.gltf"></a-asset-item>
      <a-asset-item id="egg" src="/assets/egg/eggSunnysideUp.gltf"></a-asset-item>
      <a-asset-item id="radio" src="/assets/radio/model.gltf"></a-asset-item>
    </a-assets>


    <!-- Lights -->
    <a-entity light="type: ambient; color: #CCC"></a-entity>
    <a-entity light="type: directional; color: #EEE; intensity: 0.5" position="-1 1 0"></a-entity>
    <a-entity light="color:#EEE;intensity:0.5" position="3.2 3.3 -0.2" rotation="0 -26.3 0"></a-entity>



    <!-- KITCHEN MODEL -->
    <a-entity gltf-model="#kitchen" position="-2.6 0.5 -2.5" rotation="0 141 0">
      <a-entity gltf-model="#coffeeMaker" position="-1.9684428347397913 0.6611165318954533 1.0480361652323253" rotation="0 180 0"
        scale="0.8 0.8 0.8" sound="src: #espressoMachine; volume: 1; on: click"></a-entity>
      <a-entity gltf-model="#emptyMug" position="-1.9 0.7 0.9" rotation="0 55 0" scale="0.75 0.75 0.75"></a-entity>
      <a-entity audiohandler sound="src: #music; volume: 1;autoplay:false" gltf-model="#radio" position="-2.210357318137207 0.3718644106385657 1.1893210652598343"
        rotation="0 45 0" scale="0.3 0.3 0.3"></a-entity>
      <a-entity gltf-model="#plate" position="-2.324908935706603 0.6607899348542932 1.4208847524749022" scale="0.25 0.25 0.25"></a-entity>
      <a-entity gltf-model="#toast" position="-2.355316493011995 0.7161907695660004 1.617143421798886" rotation="-90 0 0"
        scale="0.1 0.1 0.1"></a-entity>
      <a-entity gltf-model="#toast" position="-2.32 0.728 1.617143421798886" rotation="-90 0 0" scale="0.1 0.1 0.1"></a-entity>
      <a-entity gltf-model="#pan" position="-2.7954648137092604 0.3479408442703882 1.3724892368539716" rotation="0 90 0"
        scale="0.15 0.15 0.15"></a-entity>
      <a-entity gltf-model="#egg" position="-2.9991899674434763 0.7066393732063021 1.3617704499187389" scale="0.025 0.025 0.025"></a-entity>



      <!-- Toaster Sound -->
      <a-box material="opacity:0" position="-2.4 0.7 1.5" rotation="0 0 0" scale="0.25 0.25 0.25" sound="src: #toaster; volume: 1; on: click"></a-box>


      <!-- Bottle Sound -->
      <a-cylinder material="opacity:0" position="-3.1 0.7 1.5" rotation="0 0 0" scale="0.25 0.25 0.25" sound="src: #bottle; volume: 1; on: click"></a-cylinder>





    </a-entity>
    <!-- END KITCHEN MODEL -->

    <!-- Camera -->
    <a-entity position="0 1.5 0" camera wasd-controls look-controls="pointerLockEnabled: true">


      <!-- Cursor -->
      <a-entity cursor raycaster="far: .5" position="0 0 -0.3" geometry="primitive: ring; radiusInner: 0.003; radiusOuter: 0.005"
        material="color: #EE6C15">
      </a-entity>
    </a-entity>

    <!-- 
    <a-plane color="white" rotation="-90 0 0" position="0 0.8 0" width="10" height="10"></a-plane>

    <a-sky color="grey"></a-sky> -->

  </a-scene>




</body>


</html>